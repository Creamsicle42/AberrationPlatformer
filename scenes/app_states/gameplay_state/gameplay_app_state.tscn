[gd_scene load_steps=27 format=3 uid="uid://o7ta360kabrj"]

[ext_resource type="Script" path="res://scenes/app_states/gameplay_state/gameplay_app_state.gd" id="1_qtq4f"]
[ext_resource type="Script" path="res://scenes/app_states/gameplay_state/level_system/level_manager.gd" id="2_5uygt"]
[ext_resource type="Script" path="res://scenes/app_states/gameplay_state/gameplay_event_bus.gd" id="2_745si"]
[ext_resource type="PackedScene" uid="uid://bs23g6l1t6j67" path="res://scenes/_testing/player_controller/player_controller_test_world.tscn" id="4_3d1qb"]
[ext_resource type="Script" path="res://assets/resources/_types/level_data.gd" id="5_5m6h1"]
[ext_resource type="Script" path="res://scenes/app_states/gameplay_state/level_nameplate.gd" id="5_bpwq7"]
[ext_resource type="PackedScene" uid="uid://wop5emouwadi" path="res://scenes/ui/pause_menu/pause_menu.tscn" id="5_q4bcv"]
[ext_resource type="Resource" uid="uid://ccrt2betqqqwy" path="res://assets/resources/levels/sewers_1.tres" id="5_umaqc"]
[ext_resource type="Resource" uid="uid://572lus7e8gde" path="res://assets/resources/levels/sanctum.tres" id="6_yf7oq"]
[ext_resource type="Resource" uid="uid://bma2ubpk7waju" path="res://assets/resources/levels/lab_1.tres" id="7_s0wop"]
[ext_resource type="Resource" uid="uid://s3cs4pksufvd" path="res://assets/resources/levels/lab_vertical.tres" id="8_o7mcc"]
[ext_resource type="Resource" uid="uid://ht815vsp31el" path="res://assets/resources/levels/lab_2.tres" id="9_0ddqv"]
[ext_resource type="Resource" uid="uid://bgd5d4dyeobns" path="res://assets/resources/levels/lab_3.tres" id="10_ghdob"]
[ext_resource type="Resource" uid="uid://drsilt2iqcyc0" path="res://assets/resources/levels/lab_4.tres" id="11_yngpk"]
[ext_resource type="Resource" uid="uid://dykc5vdaubbjo" path="res://assets/resources/levels/lab_5.tres" id="12_73qty"]
[ext_resource type="Resource" uid="uid://b2gn71yx7qbvb" path="res://assets/resources/levels/lab_6.tres" id="13_ecpwy"]
[ext_resource type="Resource" uid="uid://f3nk53d41mgc" path="res://assets/resources/levels/lab_7.tres" id="14_cn6o6"]
[ext_resource type="Resource" uid="uid://cbmclcfcht2wh" path="res://assets/resources/levels/lab_8.tres" id="16_ak17v"]
[ext_resource type="Resource" uid="uid://bf5r3jrojnvmt" path="res://assets/resources/levels/lab_9.tres" id="17_doif3"]
[ext_resource type="Resource" uid="uid://c4t6jdmrniwe" path="res://assets/resources/levels/intro.tres" id="18_k4lmr"]
[ext_resource type="PackedScene" uid="uid://bfnaoypoxm5o4" path="res://scenes/ui/speech_bubble/speech_bubble_container.tscn" id="19_2y7p7"]
[ext_resource type="Texture2D" uid="uid://c8hdydiwjsv43" path="res://assets/textures/effects/vignete_texture.png" id="20_06ybk"]
[ext_resource type="FontFile" uid="uid://b5lu316vfv1hv" path="res://assets/fonts/RobotoMono-VariableFont_wght.ttf" id="21_nr7sn"]
[ext_resource type="Script" path="res://scenes/app_states/gameplay_state/cutscene_slide_layer.gd" id="21_thtin"]

[sub_resource type="Resource" id="Resource_rcckm"]
script = ExtResource("5_5m6h1")
name = "test_1"
level_scene = ExtResource("4_3d1qb")

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_85u23"]
bg_color = Color(0.0941176, 0.0784314, 0.145098, 1)

[node name="GameplayAppState" type="Node" node_paths=PackedStringArray("level_manager", "pause_menu")]
script = ExtResource("1_qtq4f")
level_manager = NodePath("LevelManager")
pause_menu = NodePath("PauseMenu")

[node name="GameplayEventBus" type="Node" parent="."]
script = ExtResource("2_745si")

[node name="LevelManager" type="Node" parent="." node_paths=PackedStringArray("level_parent")]
script = ExtResource("2_5uygt")
level_parent = NodePath("../Gameplay/SubViewportContainer/SubViewport/LevelParent")
levels = Array[ExtResource("5_5m6h1")]([SubResource("Resource_rcckm"), ExtResource("5_umaqc"), ExtResource("6_yf7oq"), ExtResource("7_s0wop"), ExtResource("8_o7mcc"), ExtResource("9_0ddqv"), ExtResource("10_ghdob"), ExtResource("11_yngpk"), ExtResource("12_73qty"), ExtResource("13_ecpwy"), ExtResource("14_cn6o6"), ExtResource("16_ak17v"), ExtResource("17_doif3"), ExtResource("18_k4lmr")])

[node name="Gameplay" type="CanvasLayer" parent="."]
process_mode = 1

[node name="SubViewportContainer" type="SubViewportContainer" parent="Gameplay"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
stretch = true
stretch_shrink = 4

[node name="SubViewport" type="SubViewport" parent="Gameplay/SubViewportContainer"]
handle_input_locally = false
snap_2d_transforms_to_pixel = true
snap_2d_vertices_to_pixel = true
canvas_item_default_texture_filter = 0
size = Vector2i(320, 180)
render_target_update_mode = 4

[node name="LevelParent" type="Node2D" parent="Gameplay/SubViewportContainer/SubViewport"]

[node name="CenterContainer" type="CenterContainer" parent="Gameplay"]
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -400.0
offset_right = 400.0
offset_bottom = 200.0
grow_horizontal = 2

[node name="LevelNameplate" type="Label" parent="Gameplay/CenterContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 60
text = "Level Name"
horizontal_alignment = 1
vertical_alignment = 1
script = ExtResource("5_bpwq7")

[node name="SpeechBubbleContainer" parent="Gameplay" node_paths=PackedStringArray("reference_viewport") instance=ExtResource("19_2y7p7")]
visible = false
reference_viewport = NodePath("../SubViewportContainer/SubViewport")

[node name="Vignete" type="TextureRect" parent="Gameplay"]
modulate = Color(0.0352941, 0.0196078, 0.0509804, 0.392157)
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
texture = ExtResource("20_06ybk")
expand_mode = 1

[node name="CutsceneSlideLayer" type="CanvasLayer" parent="."]
process_mode = 1
layer = 2
script = ExtResource("21_thtin")

[node name="Back" type="PanelContainer" parent="CutsceneSlideLayer"]
modulate = Color(1, 1, 1, 0)
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme_override_styles/panel = SubResource("StyleBoxFlat_85u23")

[node name="CenterContainer" type="CenterContainer" parent="CutsceneSlideLayer/Back"]
layout_mode = 2

[node name="VBoxContainer" type="VBoxContainer" parent="CutsceneSlideLayer/Back/CenterContainer"]
layout_mode = 2

[node name="SlideImage" type="TextureRect" parent="CutsceneSlideLayer/Back/CenterContainer/VBoxContainer"]
custom_minimum_size = Vector2(640, 360)
layout_mode = 2
size_flags_horizontal = 4
size_flags_vertical = 4
expand_mode = 5
stretch_mode = 4

[node name="SlideText" type="RichTextLabel" parent="CutsceneSlideLayer/Back/CenterContainer/VBoxContainer"]
layout_mode = 2
theme_override_fonts/normal_font = ExtResource("21_nr7sn")
theme_override_font_sizes/normal_font_size = 32
fit_content = true
autowrap_mode = 0
visible_characters_behavior = 1

[node name="PauseMenu" parent="." instance=ExtResource("5_q4bcv")]
layer = 3
visible = false

[connection signal="player_killed" from="GameplayEventBus" to="." method="_on_event_bus_player_killed"]
[connection signal="player_warp_needed" from="GameplayEventBus" to="." method="_on_gameplay_event_bus_player_warp_needed"]
[connection signal="level_changed" from="LevelManager" to="Gameplay/CenterContainer/LevelNameplate" method="_on_level_manager_level_changed"]
[connection signal="continue_pressed" from="PauseMenu" to="." method="_on_pause_menu_continue_pressed"]
[connection signal="go_to_main_menu_pressed" from="PauseMenu" to="." method="_on_pause_menu_go_to_main_menu_pressed"]
[connection signal="next_level_pressed" from="PauseMenu" to="." method="_on_pause_menu_next_level_pressed"]
[connection signal="restart_level_pressed" from="PauseMenu" to="." method="_on_pause_menu_restart_level_pressed"]
